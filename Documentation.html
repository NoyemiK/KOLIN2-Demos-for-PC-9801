<!DOCTYPE html><html><head><title>Programming with Kolin2</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Nimble Writer 1.16 (Steam 0x0110000104ae6d95)"><meta name="author" content="Noyemi K."><style>body {font-family: 'BatangChe', serif;font-size: 12pt;background: rgb(0,17,17);color: rgb(221,51,51);}div.container {max-width: 900px;margin: 0 auto;}div.chapter {border-bottom: 1px dashed rgb(221,51,51);}p {text-indent: 2em hanging;}.strong { font-weight: bold; }a {color: #8286FF;font-weight: bold;}/* Images */img {max-width: 100%;margin: 1em;}/* Alignment */.text-center { text-align: center; }.text-right { text-align: right; }.text-justify { text-align: justify; }/* Strong */.style2 { font-weight: bold; }.style3 { font-weight: bold; text-decoration: underline; }/* Em */.style4 { font-style: italic; }.style5 { text-decoration: underline; }/* Strikeout */.style16 { text-decoration: line-through; }/* Headers */h1 { font-size: 3em; }h2 { font-size: 2em; }h3 { font-size: 1.777em; }h4 { font-size: 1.5em; }h5 { font-size: 1.333em; }h6 { font-size: 1em; font-style: italic; }/* Code */code, pre.code {font-family: 'Consolas', monospace;background: rgb(0,58,58);padding: 0.2em;}</style><script></script></head><body><div class="container"><h1>Programming with Kolin2</h1><p class="author">Written by Noyemi K. and published on 27 October 2016</p><p></p><div class="chapter"><h2>Introduction</h2><h2>Introduction</h2>
<p>Hello there! This is the first English-language documentation for the KOLIN2 Advanced Sound BIOS by Akikaz for PC-9801. What follows is a brief primer, including some differences between the more popular PMD and this relatively little-known gem. After that, we'll be wrist deep in KOLIN2's MML.</p>
<p>I'd recommend checking out my PMD guide for a primer on OPN series and programming it in the context of other chips, and possibly also for some of the basic concepts of this MML, as they share some similarities that are a bit critical.</p>
<h2>Coming to KOLIN2 from PMD</h2>
<p><span class="style2">Differences From PMD</span> include:</p>
<ul>
<li>Ability to escape loops early in a sequence with the / character. Ex: <code>[e8r8e8r8 r2 /r1]3</code> will escape the loop on the 3rd iteration before the whole rest (r1)</li>
<li>A different tempo system, 0-255. It does not seem to specify BPM but some sort of clock multiplier instead</li>
<li>All channels available in the current driver mode (86 or 26) must be declared and given instructions. The compiler will complain about unused channels</li>
<li>KOLIN2 includes its own PCM object linker that compiles a .PO8 file for use with 86 mode</li>
<li>FM patch sizes do not include an AMS Mask flag like with PMD—patches used with PMD compositions must have this parameter removed before a file will compile</li>
<li>Board mode must be specified in the MML. If 86 is chosen, the song may not play on 26 hardware at all even if only the YM2203 channels are used</li>
</ul>
<h2>Using KOLIN2</h2>
<p>To initialize KOLIN2 in DOS V on PC-9801, navigate to the directory containing KOLIN2.COM and type <code>KOLIN2</code> to load the driver.</p>
<p>To compile an MML source file to a playable driver instruction file for KOLIN2, type </p>
<pre class="code">   
klc [option] [directory of MML file]
   </pre>
<p>To play a KOLIN2 driver instruction file, type in </p>
<pre class="code">   
klp [directory of compiled file]
   </pre>
<p>Make sure to include the extension, as KOLIN2 compiles .MO8 and .MO2 files, depending on the driver mode specified in your source file.</p>
</div><div class="chapter"><h2>KOLIN2 Basic Operation</h2><h2>KOLIN2 Preprocessor Directives</h2>
<p><code>#mode-86</code> specifies that the file is meant to be used on PC-9801-86 hardware (OPNA, .mo8 extension)</p>
<p><code>#mode-26</code> specifies that the file is meant to be used on PC-9801-26K hardware (OPN, .mo2 extension)</p>
<p><span class="style4">Note: Mode 26 files will play on PC-9801-86 and more, but not the other way round, as the PC-9801-26K and Speak Board and other hardware lacks the required components to play 86 music.</span></p>
<p><code>#octave-rev</code> reverses the direction of the octave incrementation operator notation.</p>
<p><code>#volume-rev</code> reverses the direction of the volume incrementation operator notation.</p>
<p><code>#detune-rev</code> reverses the direction of the detune incrementation operator notation.</p>
<p><code>#include &quot;Filename&quot;</code> sets additional source files to include.</p>
<p><code>#title &quot;Title&quot;</code> sets the Title metadata for the compiled music.</p>
<p><code>#composer &quot;Noyemi&quot;</code> sets the Composer metadata for the compiled music.</p>
<p><code>copyright &quot;(c) 1979 Sunrise&quot;</code> sets the Copyright metadata for the compiled music.</p>
<p><code>#pcmfile &quot;Filename.po8&quot;</code> sets the PCM block file to be used with the compiled music and triggers PCM from that table.</p>
<h2>KOLIN2 Basic Channel Elements</h2>
<p><span class="style4">The available channels for the user will depend on the mode the source file is written in!</span></p>
<p><span class="style4">FM Channels</span>:</p>
<ul>
<li>ABC (mode 26 or 86)</li>
<li>DEF (mode 86 only)</li>
</ul>
<p><span class="style4">SSG Channels</span>:</p>
<ul>
<li>GHI (mode 26 or 86)</li>
</ul>
<p><span class="style4">Rhythm/PCM (mode 86 only)</span>:</p>
<ul>
<li>R (RSS ROM)</li>
<li>S (PCM)</li>
</ul>
<hr>
<p>As with PMD and other FM program APIs for some Japanese PCs, you program FM instrument patches by specifying an instrument offset and writing a parameter array for each operator:</p>
<pre class="code">   
@[1～255] = {	 
    AR, DR, SR, RR, SL, TL, KS, ML, DT,	;Operator 1
		 AR, DR, SR, RR, SL, TL, KS, ML, DT,	;Operator 2
		 AR, DR, SR, RR, SL, TL, KS, ML, DT,	;Operator 3
		 AR, DR, SR, RR, SL, TL, KS, ML, DT,	;Operator 4
    ALG, FB }
   </pre>
<p>These have the same limitations/values as PMD, with the exception of there being no AMS mask flag.</p>
<hr>
<h2>KOLIN2 Song Sequence Commands</h2>
<p><span class="style4">Comments</span>: <code>;, /*</code></p>
<p>Any characters on the line after the comment command are ignored.</p>
<p><span class="style4">Delimiter:</span> <code>|</code></p>
<p>A useful separator that is not read by the compiler, used to mark parts in a sequence for the programmer's benefit.</p>
<p><span class="style4">End Mark:</span> <code>!</code></p>
<p>A command that halts the playback on the channel when it is reached.</p>
<p><span class="style4">Loop Macro:</span> <code>L</code></p>
<p>Channel sequence information following this macro is looped infinitely.</p>
<p><span class="style4">Iterated Loop Macro/Escape:</span> <code>[ ... / .. ]n</code></p>
<p>Information inside of <code>[ .. ]</code> will be looped n times, and optionally escaped on the last iteration by / to cut the loop short.</p>
</div></div></body></html>